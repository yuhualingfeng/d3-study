!function(){var lcharts={};lcharts.LiquidFillGauge=function(){this.liquidFillGaugeDefaultSettings=function(){return{minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8",preText:""}},this.loadLiquidFillGauge=function(elementId,value,config){function animateWave(){wave.attr("transform","translate("+waveAnimateScale(wave.attr("T"))+",0)"),wave.transition().duration(config.waveAnimateTime*(1-wave.attr("T"))).ease("linear").attr("transform","translate("+waveAnimateScale(1)+",0)").attr("T",1).each("end",function(){wave.attr("T",0),animateWave(config.waveAnimateTime)})}function GaugeUpdater(){this.update=function(value,disText){var newFinalValue=parseFloat(value).toFixed(2),textRounderUpdater=function(value){return Math.round(value)};parseFloat(newFinalValue)!=parseFloat(textRounderUpdater(newFinalValue))&&(textRounderUpdater=function(value){return parseFloat(value).toFixed(1)}),parseFloat(newFinalValue)!=parseFloat(textRounderUpdater(newFinalValue))&&(textRounderUpdater=function(value){return parseFloat(value).toFixed(2)});var textTween=function(){var i=d3.interpolate(this.textContent,parseFloat(value).toFixed(2));return function(t){this.textContent=preText+textRounderUpdater(i(t))+percentText}};text1.transition().duration(config.waveRiseTime).tween("text",textTween),text2.transition().duration(config.waveRiseTime).tween("text",textTween);var newClipArea,fillPercent=Math.max(config.minValue,Math.min(config.maxValue,value))/config.maxValue,waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent),waveRiseScale=d3.scale.linear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1]),newHeight=waveRiseScale(fillPercent),waveScaleX=d3.scale.linear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scale.linear().range([0,waveHeight]).domain([0,1]);newClipArea=config.waveHeightScaling?d3.svg.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(2*Math.PI*config.waveOffset*-1+2*Math.PI*(1-config.waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}):clipArea;var newWavePosition=config.waveAnimate?waveAnimateScale(1):0;wave.transition().duration(0).transition().duration(config.waveAnimate?config.waveAnimateTime*(1-wave.attr("T")):config.waveRiseTime).ease("linear").attr("d",newClipArea).attr("transform","translate("+newWavePosition+",0)").attr("T","1").each("end",function(){config.waveAnimate&&(wave.attr("transform","translate("+waveAnimateScale(0)+",0)"),animateWave(config.waveAnimateTime))}),waveGroup.transition().duration(config.waveRiseTime).attr("transform","translate("+waveGroupXPosition+","+newHeight+")")}}null==config&&(config=this.liquidFillGaugeDefaultSettings());var waveHeightScale,gauge=d3.select("#"+elementId),radius=Math.min(parseInt(gauge.style("width")),parseInt(gauge.style("height")))/2,locationX=parseInt(gauge.style("width"))/2-radius,locationY=parseInt(gauge.style("height"))/2-radius,fillPercent=Math.max(config.minValue,Math.min(config.maxValue,value))/config.maxValue;waveHeightScale=config.waveHeightScaling?d3.scale.linear().range([0,config.waveHeight,0]).domain([0,50,100]):d3.scale.linear().range([config.waveHeight,config.waveHeight]).domain([0,100]);var textPixels=config.textSize*radius/2,textFinalValue=parseFloat(value).toFixed(2),textStartValue=config.valueCountUp?config.minValue:textFinalValue,percentText=config.displayPercent?"%":"",preText=config.preText,circleThickness=config.circleThickness*radius,circleFillGap=config.circleFillGap*radius,fillCircleMargin=circleThickness+circleFillGap,fillCircleRadius=radius-fillCircleMargin,waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent),waveLength=2*fillCircleRadius/config.waveCount,waveClipCount=1+config.waveCount,waveClipWidth=waveLength*waveClipCount,textRounder=function(value){return Math.round(value)};parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function(value){return parseFloat(value).toFixed(1)}),parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function(value){return parseFloat(value).toFixed(2)});for(var data=[],i=0;40*waveClipCount>=i;i++)data.push({x:i/(40*waveClipCount),y:i/40});var gaugeCircleX=d3.scale.linear().range([0,2*Math.PI]).domain([0,1]),gaugeCircleY=d3.scale.linear().range([0,radius]).domain([0,radius]),waveScaleX=d3.scale.linear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scale.linear().range([0,waveHeight]).domain([0,1]),waveRiseScale=d3.scale.linear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1]),waveAnimateScale=d3.scale.linear().range([0,waveClipWidth-2*fillCircleRadius]).domain([0,1]),textRiseScaleY=d3.scale.linear().range([fillCircleMargin+2*fillCircleRadius,fillCircleMargin+.7*textPixels]).domain([0,1]),gaugeGroup=gauge.append("g").attr("transform","translate("+locationX+","+locationY+")"),gaugeCircleArc=d3.svg.arc().startAngle(gaugeCircleX(0)).endAngle(gaugeCircleX(1)).outerRadius(gaugeCircleY(radius)).innerRadius(gaugeCircleY(radius-circleThickness));gaugeGroup.append("path").attr("d",gaugeCircleArc).style("fill",config.circleColor).attr("transform","translate("+radius+","+radius+")");var text1=gaugeGroup.append("text").text(preText+textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",textPixels+"px").style("fill",config.textColor).attr("transform","translate("+radius+","+textRiseScaleY(config.textVertPosition)+")"),clipArea=d3.svg.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(2*Math.PI*config.waveOffset*-1+2*Math.PI*(1-config.waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}),waveGroup=gaugeGroup.append("defs").append("clipPath").attr("id","clipWave"+elementId),wave=waveGroup.append("path").datum(data).attr("d",clipArea).attr("T",0),fillCircleGroup=gaugeGroup.append("g").attr("clip-path","url(#clipWave"+elementId+")");fillCircleGroup.append("circle").attr("cx",radius).attr("cy",radius).attr("r",fillCircleRadius).style("fill",config.waveColor);var text2=fillCircleGroup.append("text").text(preText+textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",textPixels+"px").style("fill",config.waveTextColor).attr("transform","translate("+radius+","+textRiseScaleY(config.textVertPosition)+")");if(config.valueCountUp){var textTween=function(){var i=d3.interpolate(this.textContent,textFinalValue);return function(t){this.textContent=preText+textRounder(i(t))+percentText}};text1.transition().duration(config.waveRiseTime).tween("text",textTween),text2.transition().duration(config.waveRiseTime).tween("text",textTween)}var waveGroupXPosition=fillCircleMargin+2*fillCircleRadius-waveClipWidth;return config.waveRise?waveGroup.attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(0)+")").transition().duration(config.waveRiseTime).attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(fillPercent)+")").each("start",function(){wave.attr("transform","translate(1,0)")}):waveGroup.attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(fillPercent)+")"),config.waveAnimate&&animateWave(),new GaugeUpdater}},lcharts.BubbleMenu=function(config){function update(root){var bubbleObj=svg.selectAll(".firstSlice").data(root.children).enter().append("g").attr("class","firstSlice").attr("id",function(d,i){return"topBubbleAndText_"+i});nTop=root.children.length,oR=w/(1+3*nTop),h=Math.ceil(w/nTop*2);var partBubbleObj=(d3.scale.category10(),bubbleObj.append("circle").attr("class","topBubble").attr("id",function(d,i){return"topBubble"+i}).attr("r",function(d){return oR}).attr("cx",function(d,i){return oR*(3*(1+i)-1)}).attr("cy",(h+oR)/3).style("fill",function(d,i){return"#eee"}).style("opacity",.3).on("click",function(){alert("centerClick")}).on("mouseover",function(d,i){return activateBubble(d,i)}),bubbleObj.append("g").attr("class","partBubble").attr("transform",function(d,i){var cx=oR*(3*(1+i)-1),cy=(h+oR)/3;return"translate("+cx+","+cy+")"}));partBubbleObj.append("path").attr("class","partBubblePath").style("fill",function(d){return d.color}).on("click",function(){alert("centerClick")}).on("mouseover",function(d,i){return activateBubble(d,i)}).each(function(d){this._current=d}),svgContainer.selectAll(".partBubblePath").data(root.children).transition().duration(750).attrTween("d",function(d,i){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){return pieTop(interpolate(t),oR,oR,0)}}),bubbleObj.append("text").attr("class","topBubbleText").attr("x",function(d,i){return oR*(3*(1+i)-1)}).attr("y",(h+oR)/3).style("fill",function(d,i){return"#444867"}).attr("font-size",20).attr("text-anchor","middle").style({"font-family":"microsoft yahei","font-weight":"bold"}).attr("dominant-baseline","middle").attr("alignment-baseline","middle").each(function(d){this._current=d}).on("click",function(){alert("centerClick")}).on("mouseover",function(d,i){return activateBubble(d,i)}),svgContainer.selectAll(".topBubbleText").data(root.children).transition().duration(750).tween("text",function(d){var i=d3.interpolate(1,d.value);return function(t){this.textContent=(100*i(t)).toFixed(2)+"%"}}),bubbleObj.append("text").attr("class","titleBubbleText").attr("x",function(d,i){return oR*(3*(1+i)-1)}).attr("y",15).style("fill",function(d,i){return"#444867"}).attr("font-size",20).style({"font-family":"microsoft yahei","font-weight":"bold"}).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("alignment-baseline","middle").on("mouseover",function(d,i){return activateBubble(d,i)}),svgContainer.selectAll(".titleBubbleText").data(root.children).text(function(d){return d.title}),bubbleObj.append("text").attr("class","subTitleBubbleText").attr("x",function(d,i){return oR*(3*(1+i)-1)}).attr("y",40).style("fill",function(d,i){return"#444867"}).attr("font-size",16).attr("font-family","microsoft yahei").attr("text-anchor","middle").attr("dominant-baseline","middle").attr("alignment-baseline","middle").text(function(d){return d.subtitle}).on("mouseover",function(d,i){return activateBubble(d,i)}),svgContainer.selectAll(".subTitleBubbleText").data(root.children).text(function(d){return d.subtitle});for(var iB=0;nTop>iB;iB++){var childBubbles=svg.selectAll(".childBubble"+iB).data(root.children[iB].children).enter().append("g");childBubbles.append("circle").attr("class","childBubble"+iB).attr("id",function(d,i){return"childBubble_"+iB+"sub_"+i}).attr("r",function(d){return oR/3}).attr("cx",function(d,i){return oR*(3*(iB+1)-1)+1.5*oR*Math.cos(45*(i-1)/180*3.1415926)}).attr("cy",function(d,i){return(h+oR)/3+1.5*oR*Math.sin(45*(i-1)/180*3.1415926)}).attr("cursor","pointer").style("opacity",.5).style("fill","#eee").on("click",function(d,i){window.open(d.address)}).on("mouseover",function(d,i){var noteText="";noteText=null==d.note||""==d.note?d.address:d.note,d3.select("#bubbleItemNote").text(noteText)}).append("svg:title").text(function(d){return d.address});childBubbles.append("text").attr("class","childBubbleText"+iB).attr("x",function(d,i){return oR*(3*(iB+1)-1)+1.5*oR*Math.cos(45*(i-1)/180*3.1415926)}).attr("y",function(d,i){return(h+oR)/3+1.5*oR*Math.sin(45*(i-1)/180*3.1415926)-5}).style("opacity",.5).attr("text-anchor","middle").style("fill",function(d,i){return d.color}).attr("font-size",6).attr("cursor","pointer").on("click",function(d,i){window.open(d.address)});svgContainer.selectAll(".childBubbleText"+iB).data(root.children[iB].children).text(function(d){return d.name});childBubbles.append("text").attr("class","childBubbleText"+iB+"2").attr("x",function(d,i){return oR*(3*(iB+1)-1)+1.5*oR*Math.cos(45*(i-1)/180*3.1415926)}).attr("y",function(d,i){return(h+oR)/3+1.5*oR*Math.sin(45*(i-1)/180*3.1415926)+10}).style("opacity",.5).attr("text-anchor","middle").style("fill",function(d,i){return d.color}).attr("font-size",6).attr("cursor","pointer").on("click",function(d,i){window.open(d.address)});svgContainer.selectAll(".childBubbleText"+iB+"2").data(root.children[iB].children).text(function(d){return d.subName})}}function activateBubble(d,i){var t=svg.transition().duration(d3.event.altKey?7500:350);t.selectAll(".topBubble").attr("cx",function(d,ii){return i==ii?oR*(3*(1+ii)-1)-.6*oR*(ii-1):i>ii?.6*oR*(3*(1+ii)-1):oR*(3*nTop+1)-.6*oR*(3*(nTop-ii)-1)}).attr("r",function(d,ii){return i==ii?1.7*oR:.8*oR}),t.selectAll(".partBubble").attr("transform",function(d,ii){var cx=function(){return i==ii?oR*(3*(1+ii)-1)-.6*oR*(ii-1):i>ii?.6*oR*(3*(1+ii)-1):oR*(3*nTop+1)-.6*oR*(3*(nTop-ii)-1)}(),cy=(h+oR)/3;return"translate("+cx+","+cy+")"}),t.selectAll(".partBubblePath").attr("d",function(d,ii){var wh=0;return wh=i==ii?1.7*oR:.8*oR,pieTop(d,wh,wh,0)}),t.selectAll(".topBubbleText").attr("x",function(d,ii){return i==ii?oR*(3*(1+ii)-1)-.6*oR*(ii-1):i>ii?.6*oR*(3*(1+ii)-1):oR*(3*nTop+1)-.6*oR*(3*(nTop-ii)-1)}).attr("font-size",function(d,ii){return i==ii?30:12}),t.selectAll(".titleBubbleText").attr("x",function(d,ii){return i==ii?oR*(3*(1+ii)-1)-.6*oR*(ii-1):i>ii?.6*oR*(3*(1+ii)-1):oR*(3*nTop+1)-.6*oR*(3*(nTop-ii)-1)}).attr("font-size",function(d,ii){return i==ii?18*1.2:18*.6}),t.selectAll(".subTitleBubbleText").attr("x",function(d,ii){return i==ii?oR*(3*(1+ii)-1)-.6*oR*(ii-1):i>ii?.6*oR*(3*(1+ii)-1):oR*(3*nTop+1)-.6*oR*(3*(nTop-ii)-1)}).attr("font-size",function(d,ii){return i==ii?19.2:9.6});for(var signSide=-1,k=0;nTop>k;k++)signSide=1,nTop/2>k&&(signSide=1),t.selectAll(".childBubbleText"+k).attr("x",function(d,i){return oR*(3*(k+1)-1)-.6*oR*(k-1)+signSide*oR*2.5*Math.cos(45*(i-1)/180*3.1415926)}).attr("y",function(d,i){return(h+oR)/3+signSide*oR*2.5*Math.sin(45*(i-1)/180*3.1415926)-5}).attr("font-size",function(){return k==i?12:6}).style("display",function(){return k==i?"block":"none"}),t.selectAll(".childBubbleText"+k+"2").attr("x",function(d,i){return oR*(3*(k+1)-1)-.6*oR*(k-1)+signSide*oR*2.5*Math.cos(45*(i-1)/180*3.1415926)}).attr("y",function(d,i){return(h+oR)/3+signSide*oR*2.5*Math.sin(45*(i-1)/180*3.1415926)+10}).attr("font-size",function(){return k==i?12:6}).style("display",function(){return k==i?"block":"none"}),t.selectAll(".childBubble"+k).attr("cx",function(d,i){return oR*(3*(k+1)-1)-.6*oR*(k-1)+signSide*oR*2.5*Math.cos(45*(i-1)/180*3.1415926)}).attr("cy",function(d,i){return(h+oR)/3+signSide*oR*2.5*Math.sin(45*(i-1)/180*3.1415926)}).attr("r",function(){return k==i?.55*oR:oR/3}).style("display",function(){return k==i?"block":"none"})}function pieTop(d,rx,ry,ir){if(d.startAngle=2*Math.PI*.75,d.endAngle=2*Math.PI*(.75+d.value),d.endAngle-d.startAngle==0)return"M 0 0";var sx=rx*Math.cos(d.startAngle),sy=ry*Math.sin(d.startAngle),ex=rx*Math.cos(d.endAngle),ey=ry*Math.sin(d.endAngle),ret=[];return ret.push("M",sx,sy,"A",rx,ry,"0",d.endAngle-d.startAngle>Math.PI?1:0,"1",ex,ey,"L",ir*ex,ir*ey),ret.push("A",ir*rx,ir*ry,"0",d.endAngle-d.startAngle>Math.PI?1:0,"0",ir*sx,ir*sy,"z"),ret.join(" ")}var w=config.width||.68*window.innerWidth*.95,h=config.height||Math.ceil(.7*w),oR=0,nTop=0,svgContainer=d3.select(config.container).style("height",h+"px"),svg=d3.select(config.container).append("svg").attr("class","mainBubbleSVG").attr("width",w).attr("height",h).on("mouseleave",function(){return resetBubbles()});return update(config.data),resetBubbles=function(){w=config.width||.68*window.innerWidth*.95,oR=w/(1+3*nTop),h=Math.ceil(w/nTop*2),svg.attr("width",w);var t=svg.transition().duration(650);t.selectAll(".topBubble").attr("r",function(d){return oR}).attr("cx",function(d,i){return oR*(3*(1+i)-1)}).attr("cy",(h+oR)/3),t.selectAll(".partBubble").attr("transform",function(d,i){var cx=oR*(3*(1+i)-1),cy=(h+oR)/3;return"translate("+cx+","+cy+")"}),t.selectAll(".partBubblePath").attr("d",function(d,i){return pieTop(d,oR,oR,0)}),t.selectAll(".topBubbleText").attr("font-size",20).attr("x",function(d,i){return oR*(3*(1+i)-1)}).attr("y",(h+oR)/3),t.selectAll(".titleBubbleText").attr("font-size",20).attr("x",function(d,i){return oR*(3*(1+i)-1)}).attr("y",15),t.selectAll(".subTitleBubbleText").attr("font-size",16).attr("x",function(d,i){return oR*(3*(1+i)-1)}).attr("y",40);for(var k=0;nTop>k;k++)t.selectAll(".childBubbleText"+k).attr("x",function(d,i){return oR*(3*(k+1)-1)+1.5*oR*Math.cos(45*(i-1)/180*3.1415926)}).attr("y",function(d,i){return(h+oR)/3+1.5*oR*Math.sin(45*(i-1)/180*3.1415926)-5}).attr("font-size",6).style("display","block"),t.selectAll(".childBubbleText"+k+"2").attr("x",function(d,i){return oR*(3*(k+1)-1)+1.5*oR*Math.cos(45*(i-1)/180*3.1415926)}).attr("y",function(d,i){return(h+oR)/3+1.5*oR*Math.sin(45*(i-1)/180*3.1415926)+10}).attr("font-size",6).style("display","block"),t.selectAll(".childBubble"+k).attr("r",function(d){return oR/3}).style("display","block").attr("cx",function(d,i){return oR*(3*(k+1)-1)+1.5*oR*Math.cos(45*(i-1)/180*3.1415926)}).attr("cy",function(d,i){return(h+oR)/3+1.5*oR*Math.sin(45*(i-1)/180*3.1415926)})},window.onresize=resetBubbles,update},lcharts.PieChartsLabels=function(config){function randomData(){var data=config.data;return data}function change(data){function midAngle(d){return d.startAngle+(d.endAngle-d.startAngle)/2}svg.append("svg:text").attr("class","aster-score").attr("dy",".35em").style({"line-height":1,"font-weight":"bold","font-size":"200%",fill:"#444867"}).attr("text-anchor","middle").text(config.centerText);var slice=svg.select(".slices").selectAll("path.slice").data(pie(data));slice.enter().insert("path").style("fill",function(d){return d.data.color}).attr("class","slice"),slice.transition().duration(1e3).attrTween("d",function(d,i){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);this._current=interpolate(0);var or=d.data.pr;return function(t){return d3.svg.arc().outerRadius(radius*or).innerRadius(.4*radius)(interpolate(t))}}),slice.exit().remove();var text=svg.select(".labels").selectAll("text").data(pie(data));text.enter().append("text").attr("dy",".35em").attr("fill",function(d){return config.fontColor||"#444867"}).text(function(d){return d.data.label}),text.transition().duration(1e3).attrTween("transform",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t),pos=outerArc.centroid(d2);return pos[0]=radius*(midAngle(d2)<Math.PI?1:-1),"translate("+pos+")"}}).styleTween("text-anchor",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t);return midAngle(d2)<Math.PI?"start":"end"}}),text.exit().remove();var polyline=svg.select(".lines").selectAll("polyline").data(pie(data));polyline.enter().append("polyline").style({opacity:.3,stroke:function(d){return d.data.color},"stroke-width":"2px",fill:"none"}),polyline.transition().duration(1e3).attrTween("points",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t),pos=outerArc.centroid(d2);return pos[0]=.95*radius*(midAngle(d2)<Math.PI?1:-1),[arc.centroid(d2),outerArc.centroid(d2),pos]}}),polyline.exit().remove()}var svgOr=d3.select(config.container).style({width:config.width+"px",height:45*config.width/96+"px"}).append("svg").style({width:"100%",height:"100%"}),svg=svgOr.append("g");svg.append("g").attr("class","slices").style({"stroke-width":"2px"}),svg.append("g").attr("class","labels"),svg.append("g").attr("class","lines");var width=config.width||960,height=config.width?45*config.width/96:450,radius=Math.min(width,height)/2,pie=d3.layout.pie().sort(null).value(function(d){return d.value}),arc=d3.svg.arc().outerRadius(.4*radius).innerRadius(.4*radius),outerArc=d3.svg.arc().innerRadius(.9*radius).outerRadius(.9*radius);svg.attr("transform","translate("+width/2+","+height/2+")");return change(randomData()),change},window.lcharts=lcharts}();